<?xml version="1.0" encoding="ISO-8859-2"?>
<!-- $Id$ -->
<!-- original version: 29505 -->

 <sect1 id="example-preseed">
 <title>Pøíklad pøedkonfiguraèního souboru</title>
<para>

Toto je kompletní funkèní pøíklad pøedkonfiguraèního souboru pro
automatizované instalace. Zpùsob pou¾ití je vysvìtlen v <xref
linkend="automatic-install"/>. Pøed pou¾itím souboru je vhodné
odkomentovat nìkteré øádky.

</para><note><para>

Pro lep¹í zobrazení v ti¹tìné pøíruèce jsme nìkteré øádky zalomili. To
je indikováno znakem pro pokraèování øádku <quote>\</quote> a poté
vìt¹ím odsazením následujícího øádku. V opravdovém souboru musí být
takto rozdìlené øádky pojeny do <emphasis>jediného</emphasis>.

</para><para>

<quote>Èistý</quote> ukázkový soubor je souèástí oficiálních
instalaèních CD v adresáøi <filename>/doc/install/manual</filename>
a také je dostupný na Internetu na adrese <ulink
url="&url-example-preseed;"></ulink>.

</para></note>

<informalexample><screen>
#### Úprava syslinux.cfg.

# Upravte soubor syslinux.cfg (nebo podobný) a na konec øádku append
# pøidejte pøíslu¹né parametry.
#
# Minimálnì musíte instalátoru øíci, odkud má stáhnout soubor
# s pøednastavením.
# Pro USB klíèenku umístìte soubor do koøenového adresáøe USB klíèenky
# a pou¾ijte následující:
#   preseed/file=/hd-media/preseed
# Pro zavádìní ze sítì pou¾ijte:
#   preseed/url=http://pocitac/cesta/k/preseed
# Pokud si vyrábíte vlastní CD, zkuste pou¾ít:
#   preseed/file=/cdrom/preseed
# Ujistìte se, ¾e soubor nakopírujete na správné místo.
#
<phrase condition="etch">
# Abyste mìli jistotu, ¾e instalátor dostane správný soubor, mù¾ete
# zadat jeho kontrolní souèet. V souèasnosti to musí být md5 souèet.
# Pokud zadaný souèet a vypoèítaný souèet souboru nebudou souhlasit,
# instalátor odmítne tento soubor pou¾ít.
#   preseed/url/checksum=5da499872becccfeda2c4872f9171c3d
#   preseed/file/checksum=5da499872becccfeda2c4872f9171c3d
#
</phrase>
# Kdy¾ u¾ upravujete soubor zavadìèe, pøidejte na stejné místo i parametr
# debconf/priority=critical, který odchytí vìt¹inu pøípadných otázek, které
# zde zapomenete nastavit.
# Dále mù¾ete v syslinux.cfg nastavit parametr timeout na 1, abyste nemuseli
# pro zavedení instalaèního systému stisknout enter.
#
# Výbìr jazyka, zemì a klávesnice nemù¾e být nastaven v souboru
# s pøednastavením, proto¾e tyto otázky se zobrazují je¹tì pøed tím,
# ne¾ se soubor s pøednastavením naète.
# Abyste se tìmto otázkám vyhnuli zadejte jádru dal¹í parametry:
#
<phrase condition="sarge">
#    languagechooser/language-name=Czech
#    countrychooser/shortlist=CZ
#    console-keymaps-at/keymap=cz-lat2
</phrase><phrase condition="etch">
#    debian-installer/locale=cs_CZ
#    console-keymaps-at/keymap=cz-lat2
</phrase>
#
# Jádro akceptuje nejvý¹e 8 parametrù a 8 promìnných prostøedí (vèetnì
# standardních voleb pro instalaèní program). Pokud tento limit
# pøekroèíte, jádra øady 2.4 pøebývající parametry zahodí, jádra 2.6
# zpanikaøí. S jádry 2.6.9 a novìj¹ími mù¾ete pou¾ít a¾ 32 parametrù
# a 32 promìnných prostøedí.
#
# Pro vìt¹inu instalací mù¾ete celkem bez problémù
# odstranit implicitní volby 'vga=normal' a 'devfs=mount', co¾ vám
# umo¾ní pøidat dal¹í volby pro pøednastavení.

#### Shellové pøíkazy.

# Pøednastavení d-i není u¾ ze své podstaty bezpeèné. Nic
# v instalaèním systému nekontroluje pokusy kolem pøeteèení bufferu
# ani zneu¾ití hodnot v souboru s pøednastaveními. Pou¾ívejte tyto
# soubory pouze z dùvìryhodných zdrojù!
# Následuje ukázka, jak v d-i spustit automaticky nìjaký shellový pøíkaz.

# První pøíkaz je spu¹tìn co nejdøíve - hned po naètení pøednastavení.
#d-i preseed/early_command              string \
#    wget http://url/k/muj.udeb -O /tmp/muj.udeb ; udpkg -i /tmp/muj.udeb
# Tento pøíkaz je spu¹tìn tìsnì pøed koncem instalace, ale je¹tì je
# pøipojen adresáø /target.
#d-i preseed/late_command               string \
#    for deb in /hd-media/*.deb; do cp $deb /target/tmp; \
#    chroot /target dpkg -i /tmp/$(basename $deb); done
# Tento pøíkaz je spu¹tìn pøi startu base-config.
#base-config base-config/early_command  string echo ahoj mami
# Poslední pøíkaz je spu¹tìn po skonèení base-config, tìsnì pøed
# výzvou login:. Takto mù¾ete doinstalovat balíky, nebo také doladit
# nastavení systému.
#base-config base-config/late_command   string \
#    apt-get install zsh; chsh -s /bin/zsh

#### Nastavení sítì.

# Pokud nahráváte soubor s pøednastavením ze sítì, pak následující
# samozøejmì nebude fungovat! V takovém pøípadì zadejte potøebné
# parametry zavadìèi jádra stejnì jako výbìr jazyka/zemì/klávesnice.
# Zavádíte-li z CD nebo USB, bude nastavení fungovat bez problémù.

# netcfg zkusí pou¾ít rozhraní, jeho¾ druhý konec je aktivní.
# Tím pádem pøeskoèí výbìr ze seznamu nalezených rozhraní.
d-i netcfg/choose_interface             select auto

# Máte-li pomalej¹í dhcp server a instalaènímu systému vypr¹í èas pøi
# èekání na odpovìï, bude u¾iteèné následující.
#d-i netcfg/dhcp_timeout		string 60

# Pokud dáváte pøednost ruènímu nastavení sítì:
#d-i netcfg/disable_dhcp                boolean true
#d-i netcfg/get_nameservers             string 192.168.1.1
#d-i netcfg/get_ipaddress               string 192.168.1.42
#d-i netcfg/get_netmask	string          255.255.255.0
#d-i netcfg/get_gateway	string          192.168.1.1
#d-i netcfg/confirm_static              boolean true

# Název poèítaèe a domény pøiøazené pøes DHCP mají vìt¹í prioritu ne¾
# hodnoty nastavené zde, nicménì takto máte jistotu, ¾e tato otázka
# nezobrazí (a» u¾ nastavení z DHCP obdr¾íme nebo ne).
d-i netcfg/get_hostname	                string  nenastavene-jmeno
d-i netcfg/get_domain	                string  nenastavena-domena

# Zaká¾e otravný dialog o WEP klíèi.
d-i netcfg/wireless_wep	                string
# Pra¹tìné DHCP jméno poèítaèe, které pou¾ívají nìkteøí ISP jako heslo.
#d-i netcfg/dhcp_hostname               string radish

#### Nastavení zrcadla.

d-i mirror/country                      string enter information manually
d-i mirror/http/hostname                string http.cz.debian.org
d-i mirror/http/directory               string /debian
d-i mirror/suite                        string testing
d-i mirror/http/proxy                   string

### Rozdìlení disku.

# Pokud má systém volné místo, mù¾ete je vybrat k automatickému rozdìlení.
#d-i partman-auto/init_automatically_partition \
#    select Use the largest continuous free space
# Alternativnì mù¾ete zadat k automatickému dìlení celý disk. Název
# zaøízení mù¾e být v tradièním formátu nebo ve formátu devfs.
# Napøíklad pro pou¾ití prvního disku, který devfs najde:
d-i partman-auto/disk                   string /dev/discs/disc0/disc

# Mù¾ete vybrat libovolný z pøednastavených schémat dìlení:
d-i partman-auto/choose_recipe          select \
    All files in one partition (recommended for new users)
#d-i partman-auto/choose_recipe         select Desktop machine
#d-i partman-auto/choose_recipe         select Multi-user workstation
# Nebo zadat vá¹ vlastní návod na dìlení...
# Formát návodu je popsán v souboru devel/partman-auto-recipe.txt.
# Pokud umíte do prostøedí d-i dostat soubor s návodem na dìlení,
# staèí na nìj odkázat.
#d-i partman-auto/expert_recipe_file    string /hd-media/recipe
# V opaèném pøípadì mù¾ete zadat celý návod na jednu øádku. Napøíklad
# vytvoøíme malou /boot oblast, vhodný swap a zbytek pou¾ijeme jako
# koøenovou oblast:
#d-i partman-auto/expert_recipe         string boot-root :: \
#    20 50 100 ext3 $primary{ } $bootable{ } method{ format } format{ } \
#    use_filesystem{ } filesystem{ ext3 } mountpoint{ /boot } .  \
#    500 10000 1000000000 ext3 method{ format } format{ } \
#    use_filesystem{ } filesystem{ ext3 } mountpoint{ / } . \
#    64 512 300% linux-swap method{ swap } format{ } .
# Pro jistotu zde uvádíme stejný recept v èitelnìj¹í podobì:
#    boot-root ::
#        40 50 100 ext3
#            $primary{ } $bootable{ }
#            method{ format } format{ }
#            use_filesystem{ } filesystem{ ext3 }
#            mountpoint{ /boot }
#        .
#        500 10000 1000000000 ext3
#            method{ format } format{ }
#            use_filesystem{ } filesystem{ ext3 }
#            mountpoint{ / }
#        .
#        64 512 300% linux-swap
#            method{ swap } format{ }
#        .

# Následujícím øeknete partmanu, aby disk rozdìlil bez potvrzení.
d-i partman/confirm_write_new_label     boolean true
d-i partman/choose_partition            select \
    Finish partitioning and write changes to disk
d-i partman/confirm                     boolean true

#### Instalace zavadìèe.

# Implicitní zavadìè (pro x86) je Grub. Chcete-li místo nìj instalovat
# LILO, odkomentujte následující:
#d-i grub-installer/skip                boolean true

# Toto je bezpeèné nastavení - pokud nenalezne jiný operaèní systém,
# nainstaluje Grub do MBR.
d-i grub-installer/only_debian          boolean true

# Toto nainstaluje Grub do MBR i kdy¾ nalezne jiný operaèní systém,
# co¾ je ménì bezpeèné, proto¾e se jiný systém nemusí zavést.
d-i grub-installer/with_other_os        boolean true

# Alternativnì mù¾ete instalovat jinam ne¾ do MBR - odkomentujete
# a upravte tyto øádky:
#d-i grub-installer/bootdev             string (hd0,0)
#d-i grub-installer/only-debian         boolean false
#d-i grub-installer/with_other_os       boolean false

##### Finishing up the first stage install.

# Vynechá poslední hlá¹ku, ¾e je instalace kompletní.
d-i prebaseconfig/reboot_in_progress    note


##### Pøednastavení base-config.

# Vynechá úvodní hlá¹ku.
base-config base-config/intro           note

# Vynechá poslední hlá¹ku.
base-config base-config/login           note

# Pokud jste instalovali správce zobrazení, ale nechcete jej spustit
# hned po dokonèení base-config.
#base-config base-config/start-display-manager      boolean false

# Nìkteré verze instalaèního systému mohou vývojáøùm Debianu hlásit
# seznam balíèkù, které jste nainstalovali, co¾ pomáhá pøi
# rozhodování, který software je oblíbený a proto by mìl být zaøazen
# na CD. Výchozí hodnotou je zákaz posílání tohoto seznamu, ale mìli
# byste zvá¾it jeho povolení.
#popularity-contest popularity-contest/participate    boolean false

###### Nastavení èasového pásma.

# Nastaví, zda jsou hardwarové hodiny v GMT.
base-config tzconfig/gmt                boolean true

# Jednoduchý výbìr èasového pásma. Promìnnou mù¾ete nastavit na
# libovolnou platnou hodnotu $TZ;
# Seznam pásem naleznete v /usr/share/zoneinfo/.
base-config  tzconfig/preseed_zone                    string Europe/Prague

# Nastavení èasových pásem døíve bývalo slo¾itej¹í a pro úplnost tedy
# následuje i star¹í varianta, kterou vyu¾ijete napø. pøi pou¾ití Sarge.

# Pokud jste instalaènímu systému øekli, ¾e ¾ijete ve Spojených
# státech, mù¾ete vybrat èasovou zónu následující promìnnou.
# (Mo¾nosti jsou: Eastern, Central, Mountain, Pacific, Alaska, Hawaii,
# Aleutian, Arizona East-Indiana, Indiana-Starke, Michigan, Samoa, other)
#base-config tzconfig/choose_country_zone/US         select Eastern
# Pokud se nacházíte v Kanadì.
# (Mo¾nosti jsou: Newfoundland, Atlantic, Eastern, Central,
# East-Saskatchewan, Saskatchewan, Mountain, Pacific, Yukon, other)
#base-config tzconfig/choose_country_zone/CA         select Eastern
# Pokud se nacházíte v Brazílii.
# (Mo¾nosti jsou: East, West, Acre, DeNoronha, other)
#base-config tzconfig/choose_country_zone/BR         select East
# Mnoho zemí má pouze jedno èasové pásmo (jako ÈR). Pokud se nacházíte
# v nìkteré z tìchto zemí, mù¾ete vybrat èasové pásmo následující
# otázkou.
#base-config tzconfig/choose_country_zone_single     boolean true
# Tato otázka slou¾í jako záchytný bod pro zemì, které mají více
# èasových pásem a které nevyhovují ¾ádné pøedchozí otázce.
# Mù¾ete zadat nìkteré z èasových pásem nebo "other".
#base-config tzconfig/choose_country_zone_multiple  select

###### Nastavení u¾ivatelských úètù.

# Sem mù¾ete zadat rootovo heslo, co¾ není nejlep¹í nápad. S touto
# volbou buïte velmi opatrní!
#passwd passwd/root-password            password jsem_r00t
#passwd passwd/root-password-again      password jsem_r00t

# Chcete-li pøeskoèit vytváøení bì¾ného u¾ivatelského úètu.
#passwd passwd/make-user                boolean false
# Alternativnì mù¾ete pøednastavit jméno u¾ivatele.
#passwd passwd/user-fullname            string Uzivatel Debianu
#passwd passwd/username                 string franta
# U¾ivatelovo heslo, opìt buïte opatrní!
#passwd passwd/user-password            password nebezpecne
#passwd passwd/user-password-again      password nebezpecne

###### Nastavení APTu.

# Tato otázka urèuje, odkud se budou instalovat balíky ve druhé fázi
# instalace. Mo¾nosti jsou cdrom, http, ftp, filesystem, edit sources
# list by hand.
base-config apt-setup/uri_type          select http

# Zvolíte-li ftp nebo http, musíte zadat zemi a zrcadlo.
base-config apt-setup/country           select enter information manually
base-config apt-setup/hostname          string http.cz.debian.org
base-config apt-setup/directory         string /debian
# Zastaví po výbìru jednoho zrcadla.
base-config apt-setup/another           boolean false

# Mù¾ete si nainstalovat software ze sekcí non-free a contrib.
#base-config apt-setup/non-free         boolean true
#base-config apt-setup/contrib          boolean true

# Povolí bezpeènostní aktualizace.
base-config apt-setup/security-updates  boolean true

###### Výbìr balíkù.

# Mù¾ete zvolit libovolnou kombinaci dostupných úloh.
# V dobì psaní to zahrnuje: Desktop environment, Web server,
# Print server, DNS server, File server, Mail server, SQL database,
# manual package selection. Poslední mo¾nost spustí aptitude.
# Také mù¾ete instalaci úloh vynechat a instalovat balíku nìjakou
# jinou cestou.
tasksel   tasksel/first   multiselect Desktop environment
#tasksel  tasksel/first   multiselect Web server, Mail server, DNS server

###### Nastavení po¹ty.

# Bìhem normální instalace se exim ptá pouze dvì otázky. (Je mo¾né
# pøednastavit i slo¾itìj¹í nastavení.)
exim4-config  exim4/dc_eximconfig_configtype \
    select no configuration at this time
exim4-config exim4/no_config boolean true

# Toto je vhodné nastavit na jméno u¾ivatele, kterého jste vytvoøili
# døíve. Pokud necháte prázdné, pùjde po¹ta pro u¾ivatele postmaster
# do /var/mail/mail.
exim4-config exim4/dc_postmaster        string

###### Nastavení X Window.

# Pøednastavení tìchto otázek je mo¾né, ale musíte znát podrobnosti
# o grafickém vybavení poèítaèe, proto¾e automatické nastavení
# X Window nerozpozná ka¾dou grafickou kartu/monitor/my¹/klávesnici.

# I kdy¾ X rozpozná správný ovladaè grafické karty, zde jej mù¾ete
# pøepsat. Vesa bude fungovat ve vìt¹inì pøípadù.
#xserver-xfree86 xserver-xfree86/config/device/driver select vesa

# Pokud se automatické rozpoznání my¹i nezdaøí, dostanete se do
# nekoneèné smyèky, proto¾e nástroj se bude ptát znovu a znovu
# a poka¾dé (ne)nalezne stejnou nefunkèní my¹.
#xserver-xfree86 xserver-xfree86/autodetect_mouse     boolean true

# Automatické rozpoznání monitoru je doporuèeno.
xserver-xfree86 xserver-xfree86/autodetect_monitor    boolean true
# Odkomentujete pokud máte LCD displej.
#xserver-xfree86 xserver-xfree86/config/monitor/lcd   boolean true
# X má tøi metody nastavení monitoru. Uká¾eme støední cestu
# ("medium"), která je dostupná v¾dy.  Mo¾nost "simple" nemusí být
# dostupná a "advanced" se ptá pøíli¹ mnoho otázek.
xserver-xfree86 xserver-xfree86/config/monitor/selection-method	\
    select medium
xserver-xfree86 xserver-xfree86/config/monitor/mode-list \
    select 1024x768 @ 60 Hz

###### V¹e ostatní.

# Je mo¾né, ¾e se objeví dal¹í otázky v závislosti na tom, jaký
# software nainstalujete nebo podle toho, co se bìhem instalace
# pokazí. Seznam v¹ech mo¾ných otázek instalaèního programu získáte
# pøíkazy:
#   debconf-get-selections --installer > file
#   debconf-get-selections >> file

# Pøednastavení mù¾e být ulo¾eno v nìkolika souborech, naètete je
# následovnì:
#d-i preseed/include                    string x.cfg

# d-i mù¾e volitelnì kontrolovat kontrolní souèty souborù
# s pøednastavením. V souèasnosti jsou podporovány pouze md5 souèty.
# Seznam souètù zadejte ve stejném poøadí, v jakém se budou naèítat
# soubory s pøednastavením.
#d-i preseed/include/checksum		string 5da499872becccfeda2c4872f9171c3d

# Zadat mù¾ete i více souborù najednou, staèí je oddìlit mezerami.
# Pozdìji uvedené volby pøepisují volby uvedené døíve. Pokud cestu
# zadáte relativnì, hledají se soubory ve stejném adresáøi, jako tento
# soubor.
# Mnohem pru¾nìj¹í je pou¾ití shellového pøíkazu, který vrátí názvy
# souborù, je¾ se mají nahrát. V na¹em pøíkladì se pøíkaz rozhoduje
# mezi soubory podle konkrétního USB zaøízení (zde vestavìné èteèky
# karet):
#d-i preseed/include_command            string \
#    if $(grep -q "GUID: 0aec3050aec305000001a003" /proc/scsi/usb-storage-*/*); \
#    then echo kraken.cfg; else echo otherusb.cfg; fi

# Chcete-li si je¹tì pøed instalací zkontrolovat formát va¹eho souboru
# s pøednastavením, mù¾ete pou¾ít debconf-set-selections:
#   debconf-set-selections -c preseed.cfg
</screen></informalexample>

 </sect1>
