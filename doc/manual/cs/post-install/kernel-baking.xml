<?xml version="1.0" encoding="ISO-8859-2"?>
<!-- $Id$ -->
<!-- original version: 16990 -->

 <sect1 id="kernel-baking"><title>Kompilace nového jádra</title>
<para>

Proè byste si chtìli sestavit nové jádro? Obvykle nejde o
nutnost, ponìvad¾ jádro dodávané s Debianem funguje ve vìt¹inì
poèítaèù. Nové jádro mù¾e být u¾iteèné v následujících situacích:

<itemizedlist>
<listitem><para>

Potøebujete vyøe¹it hardwarový konflikt zaøízení nebo speciální nároky
hardwaru, které dodávané jádro nezvládne.

</para></listitem>
<listitem><para>

Ve standardním jádøe postrádáte podporu zaøízení nebo nìjakou slu¾bu
(napø. Advanced power management nebo SMP). 

</para></listitem>

<listitem arch="i386"><para>
 
Varianty jádra compact a idepci neobsahují podporu zvuku. A i kdy¾
vanilla jádro zvukové karty podporuje, nemusí podpora zvuku z
nejrùznìj¹ích pøíèin fungovat.

</para></listitem>
<listitem><para>

Chcete men¹í jádro bez ovladaèù, které nepou¾íváte. Urychlíte start
systému a u¹etøíte pamì».

</para></listitem>
<listitem><para>

Chcete jádro roz¹íøit o nìjakou funkci (napø. firewall).

</para></listitem>
<listitem><para>

Chcete jádro z vývojové øady.

</para></listitem>
<listitem><para>

Chcete udìlat dojem na známé, vyzkou¹et nìco nového.

</para></listitem>
</itemizedlist>

</para>

  <sect2><title>Správa jader</title>
<para>

Nebojte se kompilace jádra, je to zábava a budete z ní mít u¾itek.

</para><para>

Doporuèený zpùsob kompilace jádra v Debianu vy¾aduje tyto balíky:
<classname>kernel-package</classname>,
<classname>kernel-source-&kernelversion;</classname> (aktuální verze v
dobì vzniku dokumentu), <classname>fakeroot</classname> a dal¹í, které
ji¾ máte patrnì nainstalované (úplný seznam je v souboru
<filename>/usr/share/doc/kernel-package/README.gz</filename>).

</para><para>

Tato metoda vytvoøí ze zdrojových textù jádra .deb balíèek, a jestli¾e
pou¾íváte nestandardní moduly, takté¾ z nich vyrobí aktuální balíèky. 
Pøi instalaci balíèku se do adresáøe <filename>/boot</filename> ulo¾í
pìknì pohromadì jádro, mapa symbolù <filename>System.map</filename> a
aktuální konfigurace.

</para><para>

Jádro <emphasis>nemusíte</emphasis> pøipravovat touto cestou, ale
domníváme se, ¾e s vyu¾itím balíèkovacího softwaru se proces
zjednodu¹í a je také bezpeènìj¹í. Místo balíku
<classname>kernel-source-&kernelversion;</classname> si klidnì mù¾ete
stáhnout poslední zdrojové texty jádra pøímo od Linuse.

</para><para>

Popis balíku <classname>kernel-package</classname> se nachází v
adresáøi <filename>/usr/share/doc/kernel-package</filename>.
V následujících odstavcích najdete jen struèný úvod k jeho pou¾ití.

</para><para arch="sparc">

Jestli¾e kompilujete jádro pro UltraSPARC, ujistìte se, ¾e máte
nainstalovaný balíèek <classname>egcs64</classname>, co¾ je
preferovaný pøekladaè pro 64bitová SPARC jádra. Standardní 
<command>gcc</command> sice 64bitové jádro zkompiluje také, ale ne tak
stabilnì. Také pokud zpozorujete nìjaké problémy s jádrem a po¾ádáte
nìkoho o radu, bude vám øeèeno, ¾e máte nejdøíve vyzkou¹et kompilaci
s <classname>egcs64</classname>, jestli problém sám nezmizí. 
Po instalaci <classname>egcs64</classname> nezapomeòte spustit jako
root pøíkaz <userinput>update-alternatives --config
sparc64-linux-gcc</userinput> a nastavit jako preferovaný pøekladaè
<classname>egcs64</classname>.

</para><para>

V dal¹ím budeme pøedpokládat, ¾e zdrojové texty jádra verze
&kernelversion; ulo¾íte do <filename>/usr/local/src</filename>. Jako
u¾ivatel root vytvoøte adresáø <filename>/usr/local/src</filename> a
zmìòte jeho vlastníka na vá¹ normální úèet. Pøihlaste se na svùj úèet
a pøejdìte do adresáøe, kde chcete mít zdrojové texty jádra
(<userinput>cd /usr/local/src</userinput>), rozbalte archív
(<userinput>tar xjf
/usr/src/kernel-source-&kernelversion;.tar.bz2</userinput>) a vejdìte
do vzniklého adresáøe (<userinput>cd
kernel-source-&kernelversion;/</userinput>).

</para><para>

V prostøedí X11 nakonfigurujte jádro pøíkazem <userinput>make
xconfig</userinput>, nebo v terminálu pøíkazem <userinput>make
menuconfig</userinput> (musíte mít nainstalovaný balíèek
<classname>ncurses-dev</classname>). Proètìte si nápovìdu a pozornì
vybírejte z nabízených mo¾ností. Pokud si v nìkterém bodu nebudete
vìdìt rady, je vìt¹inou lep¹í zaøízení do jádra vlo¾it. Volby, kterým
nerozumíte a které se nevztahují k hardwaru, radìji nechte na
pøednastavených hodnotách. Nezapomeòte do jádra zahrnout ,,Kernel
module loader'' (tj. automatické vkládání modulù) v sekci ,,Loadable
module support'' 

<phrase arch="alpha"> a ,,Enhanced Real Time Clock Support'' v
,,Character devices'', které pøednastavené nejsou, av¹ak Debian tyto
slu¾by pøedpokládá. </phrase>
<phrase arch="not-alpha">, které pøednastavené nebývá, av¹ak Debian
tuto slu¾bu pøedpokládá. </phrase>

</para><para>

Pøíkazem <userinput>make-kpkg clean</userinput> proèistíte strom
zdrojových textù a vynulujete pøedchozí nastavení balíku
<classname>kernel-package</classname>. 

</para><para>

Kompilaci jádra provedete pøíkazem <userinput>fakeroot make-kpkg
--revision=jadro.1.0 kernel_image</userinput>. Èíslo verze si mù¾ete
zvolit podle vlastní úvahy, slou¾í pouze k va¹í orientaci v
pøipravených balících. Kompilace zabere chvíli èasu, zále¾í na
výpoèetním výkonu va¹eho poèítaèe.

</para><para condition="supports-pcmcia">

Pokud vyu¾íváte zaøízení PCMCIA, nainstalujte také balík
<classname>pcmcia-source</classname>, který do
<filename>/usr/src</filename> nakopíruje komprimovaný soubor se
zdrojovnými texty. Tento archív rozbalte v adresáøi
<filename>/usr/src</filename>, proto¾e programy pøedpokládají, ¾e
najdou moduly v adresáøi <filename>/usr/src/modules</filename>. Balík 
s PCMCIA moduly pøipravíte pøíkazem <userinput>make-kpkg
modules_image</userinput>. Pro oba úkony musíte mít rootovská práva.

</para><para>

A¾ kompilace skonèí, jádro nainstalujete jako ka¾dý jiný balík. Jako
root napi¹te <userinput>dpkg -i
../kernel-image-&kernelversion;-<replaceable>podarchitektura</replaceable>_jadro.1.0_&architecture;.deb</userinput>. 
<replaceable>podarchitektura</replaceable> je volitelné upøesnìní
architektury,
<phrase arch="i386"> napø. ,,i586'', </phrase> které jste zadali pøi
konfiguraci jádra. <userinput>dpkg -i kernel-image...</userinput>
nainstaluje jádro spolu s doprovodnými soubory. Jedná se tøeba
o soubory 
<filename>System.map</filename>, který je u¾iteèný pøi dohledávání
problémù v jádøe, a <filename>/boot/config-&kernelversion;</filename>
obsahující konfiguraèní soubor jádra. Balík s jádrem je dostateènì
chytrý, aby bìhem instalace spustil zavadìè (pøíslu¹ný k va¹í
platformì) a obnovil zavádìcí záznamu na disku. Pokud jste vytvoøili
balík s moduly (tøeba PCMCIA nebo lm-sensors), je nanejvý¹ vhodné ho
také nainstalovat. 

</para><para>

Nyní je èas spustit systém s novým jádrem. Projdìte si chybové hlá¹ky,
které se mohly pøi instalaci jádra vyskytnout, a pokud v¹e vypadá
dobøe, restartujte pøíkazem <userinput>shutdown -r now</userinput>.

</para><para>

Popis balíku <classname>kernel-package</classname> najdete v adresáøi
<filename>/usr/share/doc/kernel-package</filename>.

</para>
  </sect2>
 </sect1>
