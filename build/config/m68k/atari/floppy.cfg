MEDIA_TYPE = floppy image

EXTRANAME = $(MEDIUM)-

MANIFEST-BOOT = "m68k atari floppy boot image"
MANIFEST-ROOT = "m68k atari floppy root image"

TARGET = bootstra.prg rawwrite.ttp $(BOOT) $(ROOT)

FLOPPY_SIZE = 1440

# gzip the floppies
GZIPPED = .gz

# The DOS volume id to use for DOS floppies: 32 bit hexidecimal number.
DOS_VOLUME_ID = deb00001
# The DOS volume label to use for DOS floppies: 11 character string.
DOS_VOLUME_LABEL = "Debian Inst"

# I think we'll need a bootfloppy + root.
# Create a bootable image.
#	msdos fat 12, auto/bootstra.prg, bootargs, linux
.PHONY: arch_boot
arch_boot: bootstra.prg
	mkfs.msdos -i $(DOS_VOLUME_ID) -n $(DOS_VOLUME_LABEL) -r 112 -F 12 -C $(TEMP_BOOT) $(FLOPPY_SIZE)
	# mkfs.msdos gets the mode wrong (bug filed)
	chmod 644 $(TEMP_BOOT)

	# generate a disk label
	./makelabel $(DISK_LABEL) $(BUILD_DATE) > $(TEMP)/disk.lbl
	mcopy -i$(TEMP_BOOT) $(TEMP)/disk.lbl ::disk.lbl

	mcopy -i$(TEMP_BOOT) $(shell echo $(TEMP_KERNEL) | cut -d' ' -f 1) ::/linux

	# atari boot stuff
	mmd -i$(TEMP_BOOT) ::/auto
	mcopy -i$(TEMP_BOOT) $(SOME_DEST)/bootstra.prg ::/auto
	mcopy -i$(TEMP_BOOT) boot/m68k/atari-bootargs-floppy ::/bootargs
	
	$(if $(GZIPPED),gzip -v9f $(TEMP_BOOT))

.PHONY: arch_boot_screens
arch_boot_screens:

.PHONY: arch_root
arch_root: 
	mkfs.msdos -i $(DOS_VOLUME_ID) -n $(DOS_VOLUME_LABEL) -r 112 -F 12 -C $(TEMP_ROOT) $(FLOPPY_SIZE)
	# mkfs.msdos gets the mode wrong (bug filed)
	chmod 644 $(TEMP_ROOT)

	# generate a disk label
	./makelabel $(DISK_LABEL) $(BUILD_DATE) > $(TEMP)/disk.lbl
	mcopy -i$(TEMP_ROOT) $(TEMP)/disk.lbl ::disk.lbl

	mcopy -i$(TEMP_ROOT) $(TEMP_INITRD) ::initrd.gz

	$(if $(GZIPPED),gzip -v9f $(TEMP_ROOT))

