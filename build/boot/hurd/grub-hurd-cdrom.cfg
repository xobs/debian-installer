set cd=$root
set default=3
set timeout=-1

if loadfont /boot/grub/font.pf2 ; then
	set gfxmode=640x480
	insmod vbe
	insmod gfxterm
	terminal_output gfxterm
fi

insmod png
if background_image /boot/grub/splash.png ; then
	set color_normal=white/black
	set color_highlight=black/white
else
	set menu_color_normal=cyan/blue
	set menu_color_highlight=white/blue
fi

menuentry "Debian GNU/Hurd installer boot menu" {
	true
}

menuentry "" {
	true
}

function boot_one {
	echo "Loading ..."
	set root=$cd
	multiboot /boot/kernel/gnumach.gz $options desktop=xfce
	module --nounzip /boot/${gtk}initrd.gz initrd '$(ramdisk-create)'
	module /boot/kernel/ext2fs.static ext2fs \
			--multiboot-command-line='${kernel-command-line}' \
			--host-priv-port='${host-port}' \
			--device-master-port='${device-port}' \
			--exec-server-task='${exec-task}' -T typed gunzip:device:rd0 \
			'$(task-create)' '$(task-resume)'
	module /boot/kernel/ld.so.1 exec /hurd/exec '$(exec-task=task-create)'
}

menuentry "Text install" {
	set options="TERM=mach-color"
	boot_one
}

menuentry "Pseudo-graphical install" {
	set options="GTK_NOVESA=1"
	boot_one
}

menuentry "Graphical install" {
	set options=""
        set gtk="gtk/"
	boot_one
}

menuentry "Automated install" {
	set options="auto=true priority=critical TERM=mach-color"
	boot_one
}

menuentry "Expert install" {
	set options="priority=low TERM=mach-color"
	boot_one
}

menuentry "" {
	true
}

menuentry "Boot from first hard disk" {
	set root=hd0
	chainloader +1
}
